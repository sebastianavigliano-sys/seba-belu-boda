<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sebasti√°n y Bel√©n ¬∑ Boda</title>
  <meta name="description" content="Invitaci√≥n digital: Sebasti√°n y Bel√©n ¬∑ 20 de marzo de 2026 ¬∑ House Barrio Septiembre" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap');

    /* ===== HUGHSON (LOCAL) ===== */
    @font-face{
      font-family: "Hughson";
      src: url("fonts/hughson-italic.ttf") format("truetype");
      font-weight: 400;
      font-style: italic;
    }

    :root{
      --bg:#0f0f12;
      --paper:#15151a;
      --paper2:#121218;

      --text:#f4f0ea;
      --muted:#bcb6ad;

      --sage:#9a8f7e;
      --sage-dark:#cbbba4;

      --accent:#c9b59b;
      --accent-dark:#a89174;

      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family: "Inter", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    .container{
      max-width: 900px;
      margin: 0 auto;
      padding: 0 18px;
    }

    /* =========================================================
       HERO
       ========================================================= */
    .hero{
      position: relative;
      margin: 18px auto 30px auto;
      border-radius: 26px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .hero img{
      width:100%;
      height: 640px;
      object-fit: cover;
      object-position: 50% 35%;
      filter: contrast(1.05) saturate(1.05);
      display:block;
    }

    .hero::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(to bottom, rgba(0,0,0,.30), rgba(0,0,0,.80));
      z-index: 1;
    }

    .hero-content{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      align-items:center;
      text-align:center;
      padding: 26px 20px 24px;
      z-index:2;
      color: #fff;
    }

    .hero-top{
      width: 100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      margin-top: 6px;
    }

    .hero-content .small{
      font-size: 14px;
      letter-spacing: 3px;
      text-transform: uppercase;
      opacity: .92;
      font-family: "Inter", sans-serif;
    }

    /* =========================================================
       NOMBRE CURVADO (SVG)
       - clamp para que en celu NO se achique
       ========================================================= */
    .hero-name{
  width: 100%;
  height: 180px;
  margin: 6px 0 0;
  padding: 0 12px;
}

.hero-name text{
  font-family: "Hughson", "Great Vibes", "Playfair Display", serif;
  font-size: clamp(110px, 16vw, 200px);
  font-style: italic;
  fill: #fff;
  letter-spacing: 1px;

  text-shadow: 0 10px 28px rgba(0,0,0,.60);
  -webkit-text-stroke: 1px rgba(0,0,0,.18);
}

    .hero-content .date{
      margin-top: 4px;
      font-size: 15px;
      letter-spacing: 1px;
      opacity: .95;
      font-family: "Inter", sans-serif;
    }

    /* Countdown abajo centrado */
    .hero-bottom{
      width: 100%;
      display:flex;
      justify-content:center;
      align-items:center;
      padding-bottom: 6px;
    }

    .countdown{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      justify-content:center;
    }

    .countdown div{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(12px);
      padding: 12px 16px;
      border-radius: 14px;
      min-width: 86px;
    }

    .countdown strong{
      font-family: "Playfair Display", serif;
      font-size: 30px;
      display:block;
      font-weight: 600;
    }

    .countdown span{
      font-size: 11px;
      opacity: .9;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-family: "Inter", sans-serif;
    }

    /* ===== SECTION ===== */
    .section{
      background: var(--paper);
      border-radius: var(--radius);
      padding: 40px 26px;
      margin: 18px auto;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06);
    }

    .section.alt{ background: var(--paper2); }

    .section h3{
      text-align:center;
      font-size: 14px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--sage-dark);
      margin-bottom: 12px;
    }

    .section h4{
      text-align:center;
      font-family: "Playfair Display", serif;
      font-size: 34px;
      font-weight: 500;
      margin-bottom: 16px;
      color: var(--text);
    }

    .section p{
      text-align:center;
      color: var(--muted);
      max-width: 680px;
      margin: 0 auto;
    }

    /* ===== CARDS ===== */
    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-top: 28px;
    }

    .card{
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 22px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
      text-align:center;
    }

    .icon{
      font-size: 28px;
      margin-bottom: 10px;
      opacity: .9;
    }

    .card .title{
      font-size: 13px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--sage-dark);
      margin-bottom: 10px;
    }

    .card .info{
      font-size: 15px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    /* ===== BUTTONS ===== */
    .btn{
      display:inline-block;
      text-decoration:none;
      background: var(--accent);
      color: #0f0f12;
      padding: 12px 18px;
      border-radius: 999px;
      font-size: 13px;
      letter-spacing: 2px;
      text-transform: uppercase;
      transition: .2s;
      font-weight: 600;
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
    }

    .btn:hover{
      transform: translateY(-2px);
      background: var(--accent-dark);
    }

    /* ===== MUSICA: bot√≥n original oculto ===== */
    #musicBtn{ display:none !important; }

    /* ===== BOTON MUSICA GRANDE ===== */
    .music-block{
      display: flex;
      justify-content: center;
      margin-bottom: 18px;
    }

    #musicBtnInline{
      width: 100%;
      max-width: 560px;
      padding: 18px 18px;
      border-radius: 999px;

      background: linear-gradient(135deg, #ffd36e, #c9b59b, #a89174);
      color: #1a1410;

      font-size: 14px;
      letter-spacing: 1.6px;
      text-transform: uppercase;
      font-weight: 900;

      border: 1px solid rgba(255,255,255,.25);
      cursor: pointer;

      box-shadow:
        0 18px 45px rgba(0,0,0,.55),
        0 0 0 2px rgba(255,211,110,.18),
        0 0 28px rgba(255,211,110,.18);

      transition: transform .18s ease, filter .18s ease, box-shadow .18s ease;

      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-align: center;

      animation: musicPulse 1.25s ease-in-out infinite;
      will-change: transform;
    }

    #musicBtnInline:hover{
      transform: translateY(-2px) scale(1.01);
      filter: brightness(1.03);
    }

    #musicBtnInline.is-on{
      animation: none;
      background: rgba(255,255,255,.10);
      color: #fff;
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 14px 35px rgba(0,0,0,.45);
    }

    @keyframes musicPulse{
      0%   { transform: translateY(0) scale(1); box-shadow: 0 18px 45px rgba(0,0,0,.55), 0 0 0 2px rgba(255,211,110,.16), 0 0 22px rgba(255,211,110,.12); }
      50%  { transform: translateY(-6px) scale(1.02); box-shadow: 0 22px 55px rgba(0,0,0,.60), 0 0 0 2px rgba(255,211,110,.22), 0 0 34px rgba(255,211,110,.22); }
      100% { transform: translateY(0) scale(1); box-shadow: 0 18px 45px rgba(0,0,0,.55), 0 0 0 2px rgba(255,211,110,.16), 0 0 22px rgba(255,211,110,.12); }
    }

    @media (prefers-reduced-motion: reduce){
      #musicBtnInline{ animation: none; }
    }

    .music-gate{
      margin: 6px auto 18px;
      max-width: 680px;
      text-align: center;
      padding: 14px 16px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.85);
      letter-spacing: 1px;
      backdrop-filter: blur(10px);
    }

    .stack.is-locked{
      position: relative;
      pointer-events: none;
      opacity: .55;
    }

    /* ===== STACK SLIDER ===== */
    .stack{
      margin-top: 22px;
      margin-bottom: 0;
    }

    .stack-frame{
      position: relative;
      width: 100%;
      height: auto;
      aspect-ratio: 4 / 5;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      background: rgba(255,255,255,.03);
    }

    @media(min-width: 600px){
      .stack-frame{
        aspect-ratio: 16 / 9;
      }
    }

    .stack-frame::before{
      content:"";
      position:absolute;
      inset:0;
      background-image: var(--stack-bg);
      background-size: cover;
      background-position: center;
      filter: blur(22px);
      transform: scale(1.25);
      opacity: .55;
      z-index: 0;
    }

    .stack-frame::after{
      content:"";
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.25);
      z-index: 0;
    }

    .stack-img{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 10px;
      opacity: 0;
      transform: scale(1.04);
      transition: opacity 650ms ease, transform 1400ms ease;
      will-change: opacity, transform;
      z-index: 1;
    }

    .stack-img.is-active{
      opacity: 1;
      transform: scale(1.0);
    }

    .stack-dots{
      display:flex;
      gap: 8px;
      justify-content:center;
      margin-top: 12px;
    }

    .stack-dot{
      width: 7px;
      height: 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.10);
      cursor: pointer;
      transition: .2s;
    }

    .stack-dot.active{
      background: var(--accent);
      border-color: rgba(255,255,255,.10);
    }

    .gallery{ display: none !important; }

    .rsvp-box{ margin-top: 20px; text-align:center; }
    .rsvp-box p{ margin-bottom: 18px; }

    .footer{
      text-align:center;
      padding: 30px 0 50px;
      color: var(--sage-dark);
      font-size: 13px;
      letter-spacing: 1px;
    }

    /* ===== LIGHTBOX ===== */
    #lightboxOverlay{
      position: fixed;
      inset: 0;
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: rgba(0,0,0,.82);
      backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
    }
    #lightboxOverlay.open{ display:flex; }

    #lightboxFigure{
      width: 100%;
      max-width: 980px;
      max-height: 90vh;
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 10px;
    }

    #lightboxImg{
      width: 100%;
      max-height: 78vh;
      object-fit: contain;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      background: rgba(255,255,255,.04);
    }

    #lightboxCaption{
      color: rgba(255,255,255,.75);
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      text-align: center;
    }

    .lb-btn{
      position: fixed;
      top: 14px;
      right: 14px;
      z-index: 10001;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: #fff;
      padding: 12px 14px;
      border-radius: 999px;
      cursor: pointer;
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 30px rgba(0,0,0,.45);
      transition: .2s;
    }
    .lb-btn:hover{ transform: translateY(-2px); }

    .lb-nav{
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10001;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color: #fff;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      cursor: pointer;
      display: grid;
      place-items: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 30px rgba(0,0,0,.45);
      user-select: none;
    }
    #lbPrev{ left: 10px; }
    #lbNext{ right: 10px; }
    @media(max-width: 520px){ .lb-nav{ top: 56%; } }

    /* ===== RESPONSIVE ===== */
    @media(max-width: 768px){
      .hero img{ height: 520px; }
      .grid-2{ grid-template-columns: 1fr; }
    }

    @media(max-width: 480px){
      .hero img{ height: 520px; }
      .countdown div{ min-width: 75px; padding: 10px 12px; }
      .countdown strong{ font-size: 26px; }
    }
  </style>
</head>

<body>

  <!-- MUSICA -->
  <audio id="bgMusic" loop>
    <source src="musica.mp3" type="audio/mpeg">
    Tu navegador no soporta audio.
  </audio>

  <!-- Bot√≥n original oculto -->
  <button id="musicBtn" type="button">üéµ M√∫sica</button>

  <div class="container">

    <!-- HERO -->
    <section class="hero">
      <img src="cover.jpg" alt="Sebasti√°n y Bel√©n" />

      <div class="hero-content">

        <div class="hero-top">
          <div class="small">¬°Nos casamos!</div>

          <svg class="hero-name" viewBox="0 0 1000 250" aria-label="Sebasti√°n y Bel√©n">
            <!-- CURVA: baj√° el 90 para m√°s curva / subilo para menos curva -->
            <path id="curvePath" d="M 80 155 Q 500 90 920 155" fill="transparent"/>
            <text>
              <textPath href="#curvePath" startOffset="50%" text-anchor="middle">
                Sebasti√°n y Bel√©n
              </textPath>
            </text>
          </svg>

          <div class="date">20 de marzo de 2026 ¬∑ 20:00 hs</div>
        </div>

        <div class="hero-bottom">
          <div class="countdown">
            <div>
              <strong id="days">--</strong>
              <span>D√≠as</span>
            </div>
            <div>
              <strong id="hours">--</strong>
              <span>Horas</span>
            </div>
            <div>
              <strong id="minutes">--</strong>
              <span>Min</span>
            </div>
            <div>
              <strong id="seconds">--</strong>
              <span>Seg</span>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- CEREMONIA Y FIESTA -->
    <section class="section">
      <h3>Detalles</h3>
      <h4>Ceremonia & Fiesta</h4>
      <p>Te esperamos para compartir una noche inolvidable junto a nosotros ü§ç</p>

      <div class="grid-2">
        <div class="card">
          <div class="icon">üèõÔ∏è</div>
          <div class="title">Ceremonia</div>
          <div class="info">
            <b>20:00 hs</b><br/>
            House ¬∑ Barrio Septiembre<br/>
            Buenos Aires
          </div>
          <a class="btn" target="_blank" href="https://www.google.com/maps/place/Barrio+Cerrado/@-34.3725919,-58.7825596,16z/data=!4m10!1m2!2m1!1sbarrio+septiembre+!3m6!1s0x95bb602bb5d795ad:0xddc4d83bc291385!8m2!3d-34.3684136!4d-58.7787301!15sChFiYXJyaW8gc2VwdGllbWJyZVoTIhFiYXJyaW8gc2VwdGllbWJyZZIBDGNvdW50cnlfY2x1YpoBJENoZERTVWhOTUc5blMwVkpRMEZuU1VSMGREZERaRGhuUlJBQuABAPoBBAgAECw!16s%2Fg%2F11c45tpglp?entry=ttu">Llegar</a>
        </div>

        <div class="card">
          <div class="icon">ü•Ç</div>
          <div class="title">Fiesta</div>
          <div class="info">
            <b>Luego de la ceremonia</b><br/>
            House ¬∑ Barrio Septiembre<br/>
            Buenos Aires
          </div>
          <a class="btn" target="_blank" href="https://www.google.com/maps/place/Barrio+Cerrado/@-34.3725919,-58.7825596,16z/data=!4m10!1m2!2m1!1sbarrio+septiembre+!3m6!1s0x95bb602bb5d795ad:0xddc4d83bc291385!8m2!3d-34.3684136!4d-58.7787301!15sChFiYXJyaW8gc2VwdGllbWJyZVoTIhFiYXJyaW8gc2VwdGllbWJyZZIBDGNvdW50cnlfY2x1YpoBJENoZERTVWhOTUc5blMwVkpRMEZuU1VSMGREZERaRGhuUlJBQuABAPoBBAgAECw!16s%2Fg%2F11c45tpglp?entry=ttu">Llegar</a>
        </div>
      </div>
    </section>

    <!-- NOSOTROS -->
    <section class="section alt">

      <div class="music-block">
        <button id="musicBtnInline" type="button">üéµ Hac√© click para ver nuestra historia</button>
      </div>

      <h3>Nosotros</h3>
      <h4 id="historia">Un poquito de nuestra historia</h4>
      <p>Momentos, aventuras y recuerdos que nos trajeron hasta este d√≠a ‚ú®</p>

      <div id="musicGate" class="music-gate">
        Para ver nuestra historia, activ√° la m√∫sica con el bot√≥n de arriba ‚ú®
      </div>

      <div class="stack" id="stackRoot">
        <div class="stack-frame" id="stackFrame">
          <img class="stack-img is-active" src="foto1.jpg" alt="Sebasti√°n y Bel√©n 1">
          <img class="stack-img" src="foto2.jpg" alt="Sebasti√°n y Bel√©n 2">
          <img class="stack-img" src="foto3.jpg" alt="Sebasti√°n y Bel√©n 3">
          <img class="stack-img" src="foto4.jpg" alt="Sebasti√°n y Bel√©n 4">
          <img class="stack-img" src="foto5.jpg" alt="Sebasti√°n y Bel√©n 5">
          <img class="stack-img" src="foto6.jpg" alt="Sebasti√°n y Bel√©n 6">
        </div>

        <div class="stack-dots" id="stackDots" aria-label="Galer√≠a destacada"></div>
      </div>

      <div class="gallery" aria-hidden="true">
        <img src="foto1.jpg" alt="Sebasti√°n y Bel√©n 1">
        <img src="foto2.jpg" alt="Sebasti√°n y Bel√©n 2">
        <img src="foto3.jpg" alt="Sebasti√°n y Bel√©n 3">
        <img src="foto4.jpg" alt="Sebasti√°n y Bel√©n 4">
        <img src="foto5.jpg" alt="Sebasti√°n y Bel√©n 5">
        <img src="foto6.jpg" alt="Sebasti√°n y Bel√©n 6">
      </div>
    </section>

    <!-- DRESS CODE -->
    <section class="section">
      <h3>Dress Code</h3>
      <h4>Elegante / Cocktail</h4>
      <p>Queremos que te sientas c√≥modo/a, pero con ese toque especial para una noche inolvidable ü•Ç‚ú®</p>
    </section>

    <!-- REGALO -->
    <section class="section alt">
      <h3>Regalo</h3>
      <h4>Tu presencia es nuestro mejor regalo</h4>
      <p>
        Si dese√°s realizarnos un obsequio, pod√©s ayudarnos con nuestra luna de miel ‚úàÔ∏èü§ç
        <br/><br/>
        <b>Alias:</b> <span style="color:var(--accent); font-weight:600;">sebasavinar</span>
      </p>
    </section>

    <!-- CONFIRMACION -->
    <section class="section">
      <h3>Confirmaci√≥n</h3>
      <h4>Confirm√° tu asistencia</h4>
      <div class="rsvp-box">
        <p>Hac√© click en el bot√≥n para confirmar por WhatsApp con Bel√©n üí¨</p>
        <a id="rsvpBtn" class="btn" href="#" target="_blank">Confirmar Asistencia</a>
      </div>
    </section>

    <div class="footer">
      ¬°Gracias por acompa√±arnos en este momento tan importante! ü§ç‚ú®
    </div>

  </div>

  <!-- LIGHTBOX -->
  <div id="lightboxOverlay" aria-hidden="true">
    <button id="lbClose" class="lb-btn" type="button">‚úï</button>
    <button id="lbPrev" class="lb-nav" type="button" aria-label="Anterior">‚Äπ</button>
    <button id="lbNext" class="lb-nav" type="button" aria-label="Siguiente">‚Ä∫</button>

    <figure id="lightboxFigure">
      <img id="lightboxImg" alt="Foto ampliada">
      <figcaption id="lightboxCaption"></figcaption>
    </figure>
  </div>

  <script>
    window.__musicUnlockedForStory = false;

    // ===== CUENTA REGRESIVA (Argentina UTC-3) =====
    // 20/03/2026 20:00 AR = 23:00 UTC
    const targetDate = new Date(Date.UTC(2026, 2, 20, 23, 0, 0));

    function updateCountdown(){
      const now = new Date();
      const diff = targetDate - now;

      if(diff <= 0){
        document.getElementById("days").innerText = "0";
        document.getElementById("hours").innerText = "0";
        document.getElementById("minutes").innerText = "0";
        document.getElementById("seconds").innerText = "0";
        return;
      }

      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / (3600 * 24));
      const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      document.getElementById("days").innerText = days;
      document.getElementById("hours").innerText = String(hours).padStart(2, "0");
      document.getElementById("minutes").innerText = String(minutes).padStart(2, "0");
      document.getElementById("seconds").innerText = String(seconds).padStart(2, "0");
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();

    // ===== RSVP WHATSAPP (BEL√âN) =====
    const phone = "5491153265596";
    const msg = encodeURIComponent("Hola Sebasti√°n y Bel√©n! Confirmo mi asistencia al casamiento del 20/03/2026 ü•Çüíç");
    document.getElementById("rsvpBtn").href = "https://wa.me/" + phone + "?text=" + msg;

    // ===== MUSICA + Unlock historia =====
    (function(){
      const music = document.getElementById("bgMusic");
      const musicBtn = document.getElementById("musicBtn");
      const musicBtnInline = document.getElementById("musicBtnInline");
      if(!music || !musicBtn) return;

      let playing = false;

      function setBtnPlayingUI(){
        if(musicBtnInline){
          musicBtnInline.innerText = "‚è∏ M√∫sica activada";
          musicBtnInline.classList.add("is-on");
        }
      }

      function setBtnPausedUI(){
        if(musicBtnInline){
          musicBtnInline.innerText = "üéµ Hac√© click para ver nuestra historia";
          musicBtnInline.classList.remove("is-on");
        }
      }

      async function startMusic(){
        try{
          await music.play();
          playing = true;

          window.__musicUnlockedForStory = true;
          document.dispatchEvent(new Event("music:started"));

          setBtnPlayingUI();
          return true;
        }catch(e){
          return false;
        }
      }

      function stopMusic(){
        music.pause();
        playing = false;
        setBtnPausedUI();
      }

      musicBtn.addEventListener("click", async () => {
        if(!playing){
          const ok = await startMusic();
          if(!ok) stopMusic();
        }else{
          stopMusic();
        }
      });

      if(musicBtnInline){
        musicBtnInline.addEventListener("click", () => musicBtn.click());
      }

      setBtnPausedUI();
    })();

    // ===== STACK SLIDER =====
    (function(){
      const frame = document.getElementById("stackFrame");
      const dotsWrap = document.getElementById("stackDots");
      const stackRoot = document.getElementById("stackRoot");
      const gate = document.getElementById("musicGate");
      if(!frame || !dotsWrap || !stackRoot) return;

      const slides = Array.from(frame.querySelectorAll(".stack-img"));
      if(slides.length <= 1) return;

      let idx = 0;
      let timer = null;
      const intervalMs = 2200;

      if(!window.__musicUnlockedForStory){
        stackRoot.classList.add("is-locked");
        if(gate) gate.style.display = "block";
      }else{
        stackRoot.classList.remove("is-locked");
        if(gate) gate.style.display = "none";
      }

      slides.forEach((_, i) => {
        const d = document.createElement("button");
        d.type = "button";
        d.className = "stack-dot" + (i === 0 ? " active" : "");
        d.setAttribute("aria-label", `Ir a foto ${i+1}`);
        d.addEventListener("click", () => goTo(i, true));
        dotsWrap.appendChild(d);
      });

      const dots = Array.from(dotsWrap.querySelectorAll(".stack-dot"));

      function setActive(i){
        slides.forEach((s, k) => s.classList.toggle("is-active", k === i));
        dots.forEach((d, k) => d.classList.toggle("active", k === i));
        const src = slides[i].getAttribute("src");
        frame.style.setProperty("--stack-bg", `url('${src}')`);
      }

      function goTo(i, user){
        idx = (i + slides.length) % slides.length;
        setActive(idx);
        if(user) restart();
      }

      function next(){ goTo(idx + 1, false); }

      function start(){
        stop();
        timer = setInterval(next, intervalMs);
      }

      function stop(){
        if(timer) clearInterval(timer);
        timer = null;
      }

      function restart(){
        stop();
        start();
      }

      frame.addEventListener("touchstart", stop, {passive:true});
      frame.addEventListener("touchend", start, {passive:true});

      setActive(0);

      function unlockStory(){
        window.__musicUnlockedForStory = true;
        stackRoot.classList.remove("is-locked");
        if(gate) gate.style.display = "none";
        start();
        document.removeEventListener("music:started", unlockStory);
      }

      if(window.__musicUnlockedForStory){
        start();
      }else{
        document.addEventListener("music:started", unlockStory);
      }
    })();
  </script>

</body>
</html>
